{"version":3,"file":"Chat.js","sourceRoot":"","sources":["../src/Chat.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { findDOMNode } from 'react-dom';\n\nimport { BehaviorSubject } from 'rxjs/BehaviorSubject';\nimport { Observable } from 'rxjs/Observable';\nimport { Subscription } from 'rxjs/Subscription';\n\nimport { Activity, CardActionTypes, ConnectionStatus, DirectLine, DirectLineOptions, IBotConnection, User } from 'botframework-directlinejs';\nimport { Provider } from 'react-redux';\nimport { getTabIndex } from './getTabIndex';\nimport * as konsole from './Konsole';\nimport { Speech } from './SpeechModule';\nimport { SpeechOptions } from './SpeechOptions';\nimport { ChatActions, createStore, HistoryAction, sendMessage, WindowState } from './Store';\nimport { ActivityOrID, FormatOptions } from './Types';\n\nimport { Cookies } from 'react-cookie';\n\nexport interface ChatProps {\n    adaptiveCardsHostConfig: any;\n    bot: User;\n    botConnection?: IBotConnection;\n    chatTitle?: boolean | string;\n    directLine?: DirectLineOptions;\n    disabled?: boolean;\n    formatOptions?: FormatOptions;\n    locale?: string;\n    history?: () => Promise<Activity[]>;\n    resize?: 'none' | 'window' | 'detect';\n    selectedActivity?: BehaviorSubject<ActivityOrID>;\n    sendTyping?: boolean;\n    showUploadButton?: boolean;\n    speechOptions?: SpeechOptions;\n    user: User;\n    botIconUrl: string;\n    chatIconColor: string;\n    chatIconMessage?: string;\n    showBrandMessage: boolean;\n    brandMessage: string;\n    windowStatus: WindowState;\n    hideHeader: boolean;\n}\n\nimport { History } from './History';\nimport { MessagePane } from './MessagePane';\nimport { Shell, ShellFunctions } from './Shell';\n\nexport class Chat extends React.Component<ChatProps, {}> {\n\n    private store = createStore();\n\n    private user: User;\n    private botConnection: IBotConnection;\n\n    private activitySubscription: Subscription;\n    private connectionStatusSubscription: Subscription;\n    private selectedActivitySubscription: Subscription;\n    private shellRef: React.Component & ShellFunctions;\n    private historyRef: React.Component;\n    private chatviewPanelRef: HTMLElement;\n    private firstLoad: boolean;\n    private showChatIconMessage: boolean;\n\n    private resizeListener = () => this.setSize();\n\n    // tslint:disable:variable-name\n    private _handleCardAction = this.handleCardAction.bind(this);\n    private _handleKeyDownCapture = this.handleKeyDownCapture.bind(this);\n    private _saveChatviewPanelRef = this.saveChatviewPanelRef.bind(this);\n    private _saveHistoryRef = this.saveHistoryRef.bind(this);\n    private _saveShellRef = this.saveShellRef.bind(this);\n\n    private hasHistory: boolean;\n    // tslint:enable:variable-name\n\n    getUser() {\n        const user = { ...this.props.user };\n\n        if (!this.props.user) {\n            // Get the cookies bui and bun\n            const cookie = new Cookies();\n            const botUserId = cookie.get('bui');\n            const botUserName = cookie.get('bun');\n\n            user.id = botUserId ? botUserId : `${this.store.getState().format.strings.anonymousUsername} ${(Math.random() * 1000000).toString().substring(0, 5)}`;\n            user.name = botUserName ? botUserName : user.id;\n            user.role = 'user';\n\n            // Set the cookies bui and bun\n            cookie.set('bui', user.id, { path: '/', maxAge: 14 * 24 * 3600 });\n            cookie.set('bun', user.name, { path: '/', maxAge: 14 * 24 * 3600 });\n        }\n\n        return user;\n    }\n    constructor(props: ChatProps) {\n        super(props);\n\n        konsole.log('BotChat.Chat props', props);\n\n        this.store.dispatch<ChatActions>({\n            type: 'Set_Locale',\n            locale: props.locale || (window.navigator as any).userLanguage || window.navigator.language || 'en'\n        });\n\n        this.user = this.getUser();\n\n        if (typeof props.windowStatus !== 'undefined' && typeof props.windowStatus.visible !== 'undefined') {\n            this.store.dispatch<ChatActions>({ type: 'Set_Status', visible: props.windowStatus.visible });\n        }\n\n        if (typeof props.chatIconColor !== 'undefined') {\n            this.store.dispatch<ChatActions>({ type: 'Set_ChatIcon_Color', chatIconColor: props.chatIconColor });\n        }\n\n        if (typeof props.chatIconMessage !== 'undefined' && props.chatIconMessage !== '') {\n            this.store.dispatch<ChatActions>({ type: 'Set_ChatIcon_Message', chatIconMessage: props.chatIconMessage });\n        }\n\n        if (typeof props.showBrandMessage !== 'undefined') {\n            this.store.dispatch<ChatActions>({ type: 'Set_BrandMessage_Status', showBrandMessage: props.showBrandMessage });\n            if (typeof props.brandMessage !== 'undefined') {\n                this.store.dispatch<ChatActions>({ type: 'Set_BrandMessage', brandMessage: props.brandMessage });\n            } else {\n                this.store.dispatch<ChatActions>({ type: 'Set_BrandMessage', brandMessage: 'Powered by Intelequia' });\n            }\n        }\n\n        if (typeof props.hideHeader !== 'undefined') {\n            this.store.dispatch<ChatActions>({ type: 'Set_HideHeader', hideHeader: props.hideHeader });\n        }\n\n        if (props.adaptiveCardsHostConfig) {\n            this.store.dispatch<ChatActions>({\n                type: 'Set_AdaptiveCardsHostConfig',\n                payload: props.adaptiveCardsHostConfig\n            });\n        }\n\n        let { chatTitle } = props;\n\n        if (props.formatOptions) {\n            console.warn('DEPRECATED: \"formatOptions.showHeader\" is deprecated, use \"chatTitle\" instead. See https://github.com/Microsoft/BotFramework-WebChat/blob/master/CHANGELOG.md#formatoptionsshowheader-is-deprecated-use-chattitle-instead.');\n\n            if (typeof props.formatOptions.showHeader !== 'undefined' && typeof props.chatTitle === 'undefined') {\n                chatTitle = props.formatOptions.showHeader;\n            }\n        }\n\n        if (typeof chatTitle !== 'undefined') {\n            this.store.dispatch<ChatActions>({ type: 'Set_Chat_Title', chatTitle });\n        }\n\n        if (typeof props.botIconUrl !== 'undefined') {\n            this.store.dispatch<ChatActions>({ type: 'Set_BotIcon_Url', botIconUrl: props.botIconUrl });\n        }\n\n        this.store.dispatch<ChatActions>({ type: 'Toggle_Upload_Button', showUploadButton: props.showUploadButton === false });\n\n        if (props.sendTyping) {\n            this.store.dispatch<ChatActions>({ type: 'Set_Send_Typing', sendTyping: props.sendTyping });\n        }\n\n        if (props.speechOptions) {\n            Speech.SpeechRecognizer.setSpeechRecognizer(props.speechOptions.speechRecognizer);\n            Speech.SpeechSynthesizer.setSpeechSynthesizer(props.speechOptions.speechSynthesizer);\n        }\n\n        this.hasHistory = false; // We dont know yet if it has history indeed\n    }\n\n    private handleIncomingActivity(activity: Activity) {\n        const state = this.store.getState();\n        switch (activity.type) {\n            case 'message':\n                this.store.dispatch<ChatActions>({ type: activity.from.id === state.connection.user.id ? 'Receive_Sent_Message' : 'Receive_Message', activity });\n                break;\n\n            case 'typing':\n                if (activity.from.id !== state.connection.user.id) {\n                    this.store.dispatch<ChatActions>({ type: 'Show_Typing', activity });\n                }\n                break;\n            case 'event':\n                if (activity.value.Item1 === 'Set_Status' && !activity.value.Item2) {\n                    this.onCloseWindow();\n                }\n                break;\n        }\n    }\n\n    private setSize() {\n        this.store.dispatch<ChatActions>({\n            type: 'Set_Size',\n            width: this.chatviewPanelRef.offsetWidth,\n            height: this.chatviewPanelRef.offsetHeight\n        });\n    }\n\n    private handleCardAction() {\n        try {\n            // After the user click on any card action, we will \"blur\" the focus, by setting focus on message pane\n            // This is for after click on card action, the user press \"A\", it should go into the chat box\n            const historyDOM = findDOMNode(this.historyRef) as HTMLElement;\n\n            if (historyDOM) {\n                historyDOM.focus();\n            }\n        } catch (err) {\n            // In Emulator production build, React.findDOMNode(this.historyRef) will throw an exception saying the\n            // component is unmounted. I verified we did not miss any saveRef calls, so it looks weird.\n            // Since this is an optional feature, I am try-catching this for now. We should find the root cause later.\n            //\n            // Some of my thoughts, React version-compatibility problems.\n        }\n    }\n\n    private handleKeyDownCapture(evt: React.KeyboardEvent<HTMLDivElement>) {\n        const target = evt.target as HTMLElement;\n        const tabIndex = getTabIndex(target);\n\n        if (\n            evt.altKey\n            || evt.ctrlKey\n            || evt.metaKey\n            || (!inputtableKey(evt.key) && evt.key !== 'Backspace')\n        ) {\n            // Ignore if one of the utility key (except SHIFT) is pressed\n            // E.g. CTRL-C on a link in one of the message should not jump to chat box\n            // E.g. \"A\" or \"Backspace\" should jump to chat box\n            return;\n        }\n\n        if (\n            target === findDOMNode(this.historyRef)\n            || typeof tabIndex !== 'number'\n            || tabIndex < 0\n        ) {\n            evt.stopPropagation();\n\n            let key: string;\n\n            // Quirks: onKeyDown we re-focus, but the newly focused element does not receive the subsequent onKeyPress event\n            //         It is working in Chrome/Firefox/IE, confirmed not working in Edge/16\n            //         So we are manually appending the key if they can be inputted in the box\n            if (/(^|\\s)Edge\\/16\\./.test(navigator.userAgent)) {\n                key = inputtableKey(evt.key);\n            }\n\n            // shellRef is null if Web Chat is disabled\n            if (this.shellRef) {\n                this.shellRef.focus(key);\n            }\n        }\n    }\n\n    private saveChatviewPanelRef(chatviewPanelRef: HTMLElement) {\n        this.chatviewPanelRef = chatviewPanelRef;\n    }\n\n    private saveHistoryRef(historyWrapper: any) {\n        this.historyRef = historyWrapper && historyWrapper.getWrappedInstance();\n    }\n\n    private saveShellRef(shellWrapper: any) {\n        this.shellRef = shellWrapper && shellWrapper.getWrappedInstance();\n    }\n\n    startConnection() {\n        const botConnection = this.props.directLine\n            ? (this.botConnection = new DirectLine(this.props.directLine))\n            : this.props.botConnection;\n\n        if (this.props.resize === 'window') {\n            window.addEventListener('resize', this.resizeListener);\n        }\n        this.props.history().then(value => {\n            if (value.length > 0) {\n                this.store.dispatch<HistoryAction>({\n                    type: 'Set_History',\n                    activities: value\n                });\n                this.hasHistory = true;\n            }\n        }).then(_ => {\n            // this.store.dispatch<ChatActions>({ type: 'Start_Connection', user: this.props.user, bot: this.props.bot, botConnection, selectedActivity: this.props.selectedActivity });\n            this.store.dispatch<ChatActions>({ type: 'Start_Connection', user: this.user, bot: this.props.bot, botConnection, selectedActivity: this.props.selectedActivity });\n\n            this.connectionStatusSubscription = botConnection.connectionStatus$.subscribe(connectionStatus => {\n                if (this.props.speechOptions && this.props.speechOptions.speechRecognizer) {\n                    const refGrammarId = botConnection.referenceGrammarId;\n                    if (refGrammarId) {\n                        this.props.speechOptions.speechRecognizer.referenceGrammarId = refGrammarId;\n                    }\n                }\n                if (connectionStatus === ConnectionStatus.Online && !this.hasHistory) {\n                    const cookie = new Cookies();\n                    const b = botConnection as DirectLine;\n                    const conversationId = cookie.get('bci');\n                    if (!conversationId && b && b.conversationId) {\n                        cookie.set('bci', b.conversationId, { path: '/', maxAge: 14 * 24 * 3600 });\n                    }\n                    sendEventPostBack(botConnection, 'StartConversation', { locale: this.props.locale }, this.user);\n                }\n                this.store.dispatch<ChatActions>({ type: 'Connection_Change', connectionStatus });\n            }\n            );\n\n            this.activitySubscription = botConnection.activity$.subscribe(\n                activity => this.handleIncomingActivity(activity),\n                error => konsole.log('activity$ error', error)\n            );\n\n            if (this.props.selectedActivity) {\n                this.selectedActivitySubscription = this.props.selectedActivity.subscribe(activityOrID => {\n                    this.store.dispatch<ChatActions>({\n                        type: 'Select_Activity',\n                        selectedActivity: activityOrID.activity || this.store.getState().history.activities.find(activity => activity.id === activityOrID.id)\n                    });\n                });\n            }\n        });\n    }\n\n    componentWillMount() {\n        this.firstLoad = true;\n        this.showChatIconMessage = true;\n    }\n    componentDidMount() {\n        // Now that we're mounted, we know our dimensions. Put them in the store (this will force a re-render)\n        this.setSize();\n        if (this.store.getState().windowState.visible) {\n            this.startConnection();\n        }\n        this.firstLoad = false;\n        this.showChatIconMessage = false;\n    }\n\n    componentWillUnmount() {\n        this.connectionStatusSubscription.unsubscribe();\n        this.activitySubscription.unsubscribe();\n        if (this.selectedActivitySubscription) {\n            this.selectedActivitySubscription.unsubscribe();\n        }\n        if (this.botConnection) {\n            this.botConnection.end();\n        }\n        window.removeEventListener('resize', this.resizeListener);\n    }\n\n    componentWillReceiveProps(nextProps: ChatProps) {\n        if (this.props.adaptiveCardsHostConfig !== nextProps.adaptiveCardsHostConfig) {\n            this.store.dispatch<ChatActions>({\n                type: 'Set_AdaptiveCardsHostConfig',\n                payload: nextProps.adaptiveCardsHostConfig\n            });\n        }\n\n        if (this.props.showUploadButton !== nextProps.showUploadButton) {\n            this.store.dispatch<ChatActions>({\n                type: 'Toggle_Upload_Button',\n                showUploadButton: nextProps.showUploadButton\n            });\n        }\n\n        if (this.props.chatTitle !== nextProps.chatTitle) {\n            this.store.dispatch<ChatActions>({\n                type: 'Set_Chat_Title',\n                chatTitle: nextProps.chatTitle\n            });\n        }\n    }\n\n    onClickChatIcon() {\n        this.store.dispatch<ChatActions>({\n            type: 'Set_Status',\n            visible: true\n        });\n        if (!this.store.getState().connection.botConnection) {  // If this is the first time the chat window is opened, we have to start the conversation\n            this.props.history().then(value => {\n                this.startConnection();\n                this.forceUpdate(); // I had to do this; I don't know why this dispatch doesn't force a re-render\n            });\n        }\n        const cookies = new Cookies();\n        cookies.set('bco', true, { path: '/', maxAge: 14 * 24 * 3600 });\n        this.forceUpdate();     // I had to do this; I don't know why this dispatch doesn't force a re-render\n    }\n\n    onCloseWindow() {\n        this.store.dispatch<ChatActions>({\n            type: 'Set_Status',\n            visible: false\n        });\n        const cookies = new Cookies();\n        cookies.set('bco', false, { path: '/', maxAge: 14 * 24 * 3600 });\n        this.forceUpdate();     // I had to do this; I don't know why this dispatch doesn't force a re-render\n    }\n\n    onCloseChatMessage() {\n        this.showChatIconMessage = false;\n        this.forceUpdate();\n    }\n\n    // At startup we do three render passes:\n    // 1. To determine the dimensions of the chat panel (nothing needs to actually render here, so we don't)\n    // 2. To determine the margins of any given carousel (we just render one mock activity so that we can measure it)\n    // 3. (this is also the normal re-render case) To render without the mock activity\n\n    render() {\n        const state = this.store.getState();\n        konsole.log('BotChat.Chat state', state);\n\n        const headerBotIcon = state.format.botIconUrl ? <div className=\"bot-icon\" style={{ backgroundImage: `url(${state.format.botIconUrl})` }}></div> : <div></div>;\n        const headerCloseButton = <div onClick={this.onCloseWindow.bind(this)} className=\"chat-close-button\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 2048 2048\">\n                <path d=\"M1115 1024 L1658 1567 Q1677 1586 1677 1612.5 Q1677 1639 1658 1658 Q1639 1676 1612 1676 Q1587 1676 1567 1658 L1024 1115 L481 1658 Q462 1676 436 1676 Q410 1676 390 1658 Q371 1639 371 1612.5 Q371 1586 390 1567 L934 1024 L390 481 Q371 462 371 435.5 Q371 409 390 390 Q410 372 436 372 Q462 372 481 390 L1024 934 L1567 390 Q1587 372 1612 372 Q1639 372 1658 390 Q1677 409 1677 435.5 Q1677 462 1658 481 L1115 1024 Z \"></path>\n            </svg>\n        </div>;\n        // only render real stuff after we know our dimensions\n        return (\n            <div>\n                {!!state.format.chatIconMessage &&\n                    this.showChatIconMessage &&\n                    <div\n                        className={`chat-button-message ${state.windowState.visible ? 'open' : 'close'}-button-${this.firstLoad || !state.windowState.visible ? 'no-animate' : 'animate'}`}>\n                        <div className=\"chat-button-message-arrow\"></div>\n                        <a className=\"chat-button-message-close\" onClick={this.onCloseChatMessage.bind(this)}>\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"-38000 0 42000 2048\">\n                                <path d=\"M1115 1024 L1658 1567 Q1677 1586 1677 1612.5 Q1677 1639 1658 1658 Q1639 1676 1612 1676 Q1587 1676 1567 1658 L1024 1115 L481 1658 Q462 1676 436 1676 Q410 1676 390 1658 Q371 1639 371 1612.5 Q371 1586 390 1567 L934 1024 L390 481 Q371 462 371 435.5 Q371 409 390 390 Q410 372 436 372 Q462 372 481 390 L1024 934 L1567 390 Q1587 372 1612 372 Q1639 372 1658 390 Q1677 409 1677 435.5 Q1677 462 1658 481 L1115 1024 Z \">\n                                </path>\n                            </svg>\n                        </a>\n                        <a onClick={this.onClickChatIcon.bind(this)}>\n                            <span>{state.format.chatIconMessage}</span>\n                        </a>\n                    </div>\n                }\n                <div\n                    className={`chat-button ${state.windowState.visible ? 'open' : 'close'}-button-${this.firstLoad || !state.windowState.visible ? 'no-animate' : 'animate'}`}\n                    style={{ backgroundColor: `${state.format.chatIconColor}` }}>\n                    <a onClick={this.onClickChatIcon.bind(this)} className=\"chat-button-icon\">\n                        <span>\n                            <svg viewBox=\"0 0 256 256\">\n                                <g>\n                                    <path id=\"path1\" transform=\"rotate(0,128,128) translate(54,63.7125017642975) scale(4.625,4.625)  \" fill=\"#FFFFFF\" d=\"M22.900024,11.400001C21.600037,11.400001 20.600037,12.400001 20.600037,13.700004 20.600037,14.99999 21.600037,15.999989 22.900024,15.999989 24.200012,15.999989 25.200012,14.99999 25.200012,13.700004 25.100037,12.499992 24.100037,11.400001 22.900024,11.400001z M16,11.400001C14.700012,11.400001 13.700012,12.400001 13.700012,13.700004 13.700012,14.99999 14.700012,15.999989 16,15.999989 17.299988,15.999989 18.299988,14.99999 18.299988,13.700004 18.299988,12.499992 17.299988,11.400001 16,11.400001z M9.1000366,11.400001C7.7999878,11.400001 6.7999878,12.400001 6.7999878,13.700004 6.7999878,14.99999 7.7999878,15.999989 9.1000366,15.999989 10.400024,15.999989 11.400024,14.99999 11.400024,13.700004 11.400024,12.499992 10.400024,11.400001 9.1000366,11.400001z M16,0C24.799988,7.0681381E-08 32,5.6000027 32,12.599997 32,19.499988 24.799988,25.199996 16,25.199996 13.900024,25.199996 11.900024,24.899978 10.100037,24.300002 8.2000122,25.699996 5.1000366,27.8 2.1000366,27.8 3.7000122,26.300002 4.2000122,23.39998 4.2999878,21.199998 1.6000366,18.899981 0,15.899999 0,12.599997 0,5.6000027 7.2000122,7.0681381E-08 16,0z\" />\n                                </g>\n                            </svg>\n                        </span>\n                    </a>\n                </div>\n                <Provider store={this.store}>\n                    <div\n                        className={`chat-window ${state.windowState.visible ? 'open' : 'close'}-chat-${this.firstLoad || !state.windowState.visible ? 'no-animate' : 'animate'}`}>\n                        <div\n                            className=\"wc-chatview-panel\"\n                            // className={ `wc-chatview-panel ${state.windowState.visible ? 'open-chat' : this.firstLoad ? 'close-chat-no-animate' : 'close-chat-animate'}` }\n                            onKeyDownCapture={this._handleKeyDownCapture}\n                            ref={this._saveChatviewPanelRef}\n                        >\n                            {\n                                !!state.format.chatTitle &&\n                                <div className={`wc-header ${state.format.hideHeader ? 'wc-hide' : ''}`}>\n                                    {headerBotIcon}\n                                    <span>{typeof state.format.chatTitle === 'string' ? state.format.chatTitle : state.format.strings.title}</span>\n                                    {headerCloseButton}\n                                </div>\n                            }\n                            <MessagePane disabled={this.props.disabled}>\n                                <History\n                                    disabled={this.props.disabled}\n                                    onCardAction={this._handleCardAction}\n                                    ref={this._saveHistoryRef}\n                                    showBrandMessage={state.format.showBrandMessage}\n                                />\n                            </MessagePane>\n                            {\n                                !this.props.disabled && <Shell\n                                    ref={this._saveShellRef}\n                                    showBrandMessage={state.format.showBrandMessage}\n                                />\n                            }\n                            {\n                                this.props.resize === 'detect' &&\n                                <ResizeDetector onresize={this.resizeListener} />\n                            }\n                            {\n                                state.format.showBrandMessage && <div className=\"wc-brandmessage\">{state.format.brandMessage}</div>\n                            }\n                        </div>\n                    </div>\n                </Provider>\n            </div>\n        );\n    }\n}\n\nexport type IDoCardAction = (type: CardActionTypes, value: string | object) => void;\n\nexport const doCardAction = (\n    botConnection: IBotConnection,\n    from: User,\n    locale: string,\n    sendMessage: (value: string, user: User, locale: string) => void\n): IDoCardAction => (\n    type,\n    actionValue\n) => {\n        const text = (typeof actionValue === 'string') ? actionValue as string : undefined;\n        const value = (typeof actionValue === 'object') ? actionValue as object : undefined;\n\n        switch (type) {\n            case 'imBack':\n                if (typeof text === 'string') {\n                    sendMessage(text, from, locale);\n                }\n                break;\n            case 'postBack':\n                sendPostBack(botConnection, text, value, from, locale);\n                break;\n            case 'call':\n            case 'openUrl':\n            case 'playAudio':\n            case 'playVideo':\n            case 'showImage':\n            case 'downloadFile':\n                window.open(text);\n                break;\n            case 'signin':\n                const loginWindow = window.open();\n                if (botConnection.getSessionId) {\n                    botConnection.getSessionId().subscribe(sessionId => {\n                        konsole.log('received sessionId: ' + sessionId);\n                        loginWindow.location.href = text + encodeURIComponent('&code_challenge=' + sessionId);\n                    }, error => {\n                        konsole.log('failed to get sessionId', error);\n                    });\n                } else {\n                    loginWindow.location.href = text;\n                }\n                break;\n\n            default:\n                konsole.log('unknown button type', type);\n        }\n    };\n\nexport const sendPostBack = (botConnection: IBotConnection, text: string, value: object, from: User, locale: string) => {\n    botConnection.postActivity({\n        type: 'message',\n        text,\n        value,\n        from,\n        locale,\n        channelData: {\n            postback: true\n        }\n    })\n        .subscribe(\n            id => konsole.log('success sending postBack', id),\n            error => konsole.log('failed to send postBack', error)\n        );\n};\n\nexport const sendEventPostBack = (botConnection: IBotConnection, name: string, value: object, from: User) => {\n    botConnection.postActivity({\n        type: 'event',\n        name,\n        value,\n        from,\n        channelData: {\n            postback: true\n        }\n    })\n        .subscribe(\n            id => konsole.log('success sending postBack', id),\n            error => konsole.log('failed to send postBack', error)\n        );\n};\n\nexport const renderIfNonempty = (value: any, renderer: (value: any) => JSX.Element) => {\n    if (value !== undefined && value !== null && (typeof value !== 'string' || value.length > 0)) {\n        return renderer(value);\n    }\n};\n\nexport const classList = (...args: Array<string | boolean>) => {\n    return args.filter(Boolean).join(' ');\n};\n\n// note: container of this element must have CSS position of either absolute or relative\nconst ResizeDetector = (props: {\n    onresize: () => void\n}) =>\n    // adapted to React from https://github.com/developit/simple-element-resize-detector\n    <iframe\n        style={{\n            border: 'none',\n            height: '100%',\n            left: 0,\n            margin: '1px 0 0',\n            opacity: 0,\n            pointerEvents: 'none',\n            position: 'absolute',\n            top: '-100%',\n            visibility: 'hidden',\n            width: '100%'\n        }}\n        ref={frame => {\n            if (frame) {\n                frame.contentWindow.onresize = props.onresize;\n            }\n        }}\n    />;\n\n// For auto-focus in some browsers, we synthetically insert keys into the chatbox.\n// By default, we insert keys when:\n// 1. evt.key.length === 1 (e.g. \"1\", \"A\", \"=\" keys), or\n// 2. evt.key is one of the map keys below (e.g. \"Add\" will insert \"+\", \"Decimal\" will insert \".\")\nconst INPUTTABLE_KEY: { [key: string]: string } = {\n    Add: '+',      // Numpad add key\n    Decimal: '.',  // Numpad decimal key\n    Divide: '/',   // Numpad divide key\n    Multiply: '*', // Numpad multiply key\n    Subtract: '-'  // Numpad subtract key\n};\n\nfunction inputtableKey(key: string) {\n    return key.length === 1 ? key : INPUTTABLE_KEY[key];\n}\n"]}